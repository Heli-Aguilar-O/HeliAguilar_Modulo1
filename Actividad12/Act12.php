<?php

    $tipo = (isset($_POST["tipo"]) && $_POST["tipo"] != "") ?$_POST["tipo"] : "No especifico";
    $texto = (isset($_POST["texto"]) && $_POST["texto"] != "") ?$_POST["texto"] : "No especifico";

    $morse = [
        "&nbsp&nbsp&nbsp", ".-", "-...", "-.-.", "-..",
        ".", "..-.", "--.", "....", "..",
        ".---", "-.-", ".-..", "--", "-.",
        "---", ".--.", "--.-", ".-.", "...",
        "-", "..-", "...-", ".--", "-..-",
        "-.--", "--..", "-----", ".----", "..---",
        "...--", "....-", ".....", "-....", "--...",
        "---..", "----.", ".-.-.-", "--..--", "---...",
        "..--..", ".----.", "-....-", "-..-.", ".--.-.",
        "-...-", ".-..-.", "-.-.--",];

        $ascii = ["/&nbsp", "A", "B", "C", "D",
        "E", "F", "G", "H", "I",
        "J", "K", "L", "M", "N",
        "O", "P", "Q", "R", "S",
        "T", "U", "V", "W", "X",
        "Y", "Z", "0", "1", "2",
        "3", "4", "5", "6", "7",
        "8", "9", ".", ",", ":",
        "?", "'", "-", "/", "@",
        "=", "\"", "!",];
    
    function morseindex($codigo)
    {
        $morse = [
            "&nbsp&nbsp&nbsp", ".-", "-...", "-.-.", "-..",
            ".", "..-.", "--.", "....", "..",
            ".---", "-.-", ".-..", "--", "-.",
            "---", ".--.", "--.-", ".-.", "...",
            "-", "..-", "...-", ".--", "-..-",
            "-.--", "--..", "-----", ".----", "..---",
            "...--", "....-", ".....", "-....", "--...",
            "---..", "----.", ".-.-.-", "--..--", "---...",
            "..--..", ".----.", "-....-", "-..-.", ".--.-.",
            "-...-", ".-..-.", "-.-.--",];

        $ascii = ["/&nbsp", "A", "B", "C", "D",
            "E", "F", "G", "H", "I",
            "J", "K", "L", "M", "N",
            "O", "P", "Q", "R", "S",
            "T", "U", "V", "W", "X",
            "Y", "Z", "0", "1", "2",
            "3", "4", "5", "6", "7",
            "8", "9", ".", ",", ":",
            "?", "'", "-", "/", "@",
            "=", "\"", "!",];
        
        $NODEMORSE = count($morse);

        for ($x = 0; $x < $NODEMORSE; $x++) {
            if (strcmp($morse[$x], $codigo) === 0) {
                return $x;
            }
        }
        return -1;
    }

    function asciiindex($signo) 
    {
        $cadenaTemporal = "$signo";

    
        $morse = [
        "&nbsp", ".-", "-...", "-.-.", "-..",
        ".", "..-.", "--.", "....", "..",
        ".---", "-.-", ".-..", "--", "-.",
        "---", ".--.", "--.-", ".-.", "...",
        "-", "..-", "...-", ".--", "-..-",
        "-.--", "--..", "-----", ".----", "..---",
        "...--", "....-", ".....", "-....", "--...",
        "---..", "----.", ".-.-.-", "--..--", "---...",
        "..--..", ".----.", "-....-", "-..-.", ".--.-.",
        "-...-", ".-..-.", "-.-.--",];

        $ascii = [" ", "A", "B", "C", "D",
        "E", "F", "G", "H", "I",
        "J", "K", "L", "M", "N",
        "O", "P", "Q", "R", "S",
        "T", "U", "V", "W", "X",
        "Y", "Z", "0", "1", "2",
        "3", "4", "5", "6", "7",
        "8", "9", ".", ",", ":",
        "?", "'", "-", "/", "@",
        "=", "\"", "!",];

        $NODEMORSE = count($morse);
        for ($x = 0; $x < $NODEMORSE; $x++) {
            if (strcmp($ascii[$x], $cadenaTemporal) == 0) {
                return $x;
            }
        }
        return -1;
    }


    function codifmorse() {
        //    char mensaje[] = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789.,:?'-/@=\"!";
        // Recorremos la cadena y transformamos cada letra
        
        $morse = [
        "&nbsp", ".-", "-...", "-.-.", "-..",
        ".", "..-.", "--.", "....", "..",
        ".---", "-.-", ".-..", "--", "-.",
        "---", ".--.", "--.-", ".-.", "...",
        "-", "..-", "...-", ".--", "-..-",
        "-.--", "--..", "-----", ".----", "..---",
        "...--", "....-", ".....", "-....", "--...",
        "---..", "----.", ".-.-.-", "--..--", "---...",
        "..--..", ".----.", "-....-", "-..-.", ".--.-.",
        "-...-", ".-..-.", "-.-.--",];
    
        $ascii = [" ", "A", "B", "C", "D",
                     "E", "F", "G", "H", "I",
                     "J", "K", "L", "M", "N",
                     "O", "P", "Q", "R", "S",
                     "T", "U", "V", "W", "X",
                     "Y", "Z", "0", "1", "2",
                     "3", "4", "5", "6", "7",
                     "8", "9", ".", ",", ":",
                     "?", "'", "-", "/", "@",
                     "=", "\"", "!",];

        $texto = (isset($_POST["texto"]) && $_POST["texto"] != "") ?$_POST["texto"] : "No especifico";
        $i = 0;
        
        while($texto[$i])
        {
            // Convertir a mayúscula porque tenemos equivalencias solo para mayúsculas
            // y Morse no especifica minúscula
            $textomayus = strtoupper($texto[$i]);
            $indice = asciiindex($textomayus);
            $codigoMorse = $morse[$indice];
            // Aquí puedes hacer lo que gustes con el morse, yo simplemente lo imprimo
            printf("%s ", $codigoMorse);
            $i++;
        }
     return -1;
    }

    function decodifmorse() {
        //    char mensaje[] = ".- -... -.-. -.. . ..-. --. .... .. .--- -.- .-.. -- -. --- .--. --.- .-. ... - ..- ...- .-- -..- -.-- --.. ----- .---- ..--- ...-- ....- ..... -.... --... ---.. ----. .-.-.- --..-- ---... ..--.. .----. -....- -..-. .--.-. -...- .-..-. -.-.--";
        // Aquí define tu mensaje separado por espacios
    
            $ascii = ["/&nbsp", "A", "B", "C", "D",
            "E", "F", "G", "H", "I",
            "J", "K", "L", "M", "N",
            "O", "P", "Q", "R", "S",
            "T", "U", "V", "W", "X",
            "Y", "Z", "0", "1", "2",
            "3", "4", "5", "6", "7",
            "8", "9", ".", ",", ":",
            "?", "'", "-", "/", "@",
            "=", "\"", "!",];

            $morse = ["&nbsp&nbsp&nbsp", ".-", "-...", "-.-.", "-..",
            ".", "..-.", "--.", "....", "..",
            ".---", "-.-", ".-..", "--", "-.",
            "---", ".--.", "--.-", ".-.", "...",
            "-", "..-", "...-", ".--", "-..-",
            "-.--", "--..", "-----", ".----", "..---",
            "...--", "....-", ".....", "-....", "--...",
            "---..", "----.", ".-.-.-", "--..--", "---...",
            "..--..", ".----.", "-....-", "-..-.", ".--.-.",
            "-...-", ".-..-.", "-.-.--",];
        
        $texto = (isset($_POST["texto"]) && $_POST["texto"] != "") ?$_POST["texto"] : "No especifico";
        
        $limitante = " ";
        $fichita = strtok($texto, $limitante);
        if ($fichita != FALSE) {
            while ($fichita != FALSE) {
                $index = morseindex($fichita);
                $ascii1 = $ascii[$index];
                printf("%s", $ascii1);
                $fichita = strtok($limitante);
            }
        }
    }


    if ($tipo == "a")
    {
        codifmorse();
    }

    if ($tipo == "b")
    {
        decodifmorse();
    }


?>